  document.getElementById('bullseye-widget2').innerHTML += '<div id="slidebox" class="slidebox-max minWidg"><!--<a class="arrowWrap"><div class="arrow">&nbsp;</div></a>--><a class="close">x</a><div id="bullseye-banner-header"></div></div><div class="storeImg"><img src="http://placehold.it/200"></div><a class="mapLink" href="#" target="_blank">Map and Directions</a><span class="Addr" style="display: none"></span><style>#bullseye-widget2 a,#bullseye-widget2 abbr,#bullseye-widget2 acronym,#bullseye-widget2 address,#bullseye-widget2 applet,#bullseye-widget2 big,#bullseye-widget2 blockquote,#bullseye-widget2 caption,#bullseye-widget2 cite,#bullseye-widget2 code,#bullseye-widget2 dd,#bullseye-widget2 del,#bullseye-widget2 dfn,#bullseye-widget2 div,#bullseye-widget2 dl,#bullseye-widget2 dt,#bullseye-widget2 em,#bullseye-widget2 fieldset,#bullseye-widget2 font,#bullseye-widget2 form,#bullseye-widget2 h1,#bullseye-widget2 h2,#bullseye-widget2 h3,#bullseye-widget2 h4,#bullseye-widget2 h5,#bullseye-widget2 h6,#bullseye-widget2 iframe,#bullseye-widget2 img,#bullseye-widget2 ins,#bullseye-widget2 kbd,#bullseye-widget2 label,#bullseye-widget2 legend,#bullseye-widget2 li,#bullseye-widget2 object,#bullseye-widget2 ol,#bullseye-widget2 p,#bullseye-widget2 pre,#bullseye-widget2 q,#bullseye-widget2 s,#bullseye-widget2 samp,#bullseye-widget2 small,#bullseye-widget2 span,#bullseye-widget2 strike,#bullseye-widget2 strong,#bullseye-widget2 sub,#bullseye-widget2 sup,#bullseye-widget2 table,#bullseye-widget2 tbody,#bullseye-widget2 td,#bullseye-widget2 tfoot,#bullseye-widget2 th,#bullseye-widget2 thead,#bullseye-widget2 tr,#bullseye-widget2 tt,#bullseye-widget2 ul,#bullseye-widget2 var{margin:0;padding:0;border:0;outline:0;font-weight:inherit;font-style:inherit;font-size:100%;font-family:inherit;vertical-align:baseline}#bullseye-widget2:focus{outline:0}#bullseye-widget2 ol,#bullseye-widget2 ul{list-style:none}#bullseye-widget2 *{box-sizing:border-box;line-height: 1.2;}#bullseye-widget2 #bullseye-banner-header-loader{opacity:.5}#bullseye-widget2 #slidebox{cursor:pointer;padding:0;position:fixed;width:410px;right:0;background-color:rgba(240,240,240,1);opacity:1;z-index:9999;bottom:0;height:199px}#bullseye-widget2 #slidebox *{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}#bullseye-widget2 #slidebox a{text-decoration:none}#bullseye-widget2 #slidebox #bullseye-banner-header{padding:0}#bullseye-widget2 .minWidg{bottom:-149px!important}#bullseye-widget2 .minWidg .arrow{transform:rotate(180deg);-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg)}#bullseye-widget2 .headerWrap{display:block;position:relative;height:48px}#bullseye-widget2 .headerWrap>img:first-child{transform:scale(.8);-webkit-transform:scale(.8);-moz-transform:scale(.8);-ms-transform:scale(.8);-o-transform:scale(.8);float:left;max-width: 60px;height:auto;position:relative;top:-2px}#bullseye-widget2 .headerWrap>p{float:left;font-weight:100;padding:5px;margin-top:11px;font-size:18px;color:#fff}#bullseye-widget2 #bullseye-banner-header-nearest-store>address{clear:both;float:right;margin-top:0;line-height:15px;font-size:12px;font-style:normal;color:#333;width:70%}#bullseye-widget2 #bullseye-banner-header-nearest-store>address .bullseye-banner-header-phone{display:block}#bullseye-widget2 #bullseye-banner-header-nearest-store>address .bullseye-banner-header-locname{display:block;font-size:13px;margin-top:6px;font-weight:600;font-style:normal}#bullseye-widget2 #slidebox a.close{width:13px;font-weight:700;height:13px;font-family:Verdana,sans-serif;position:absolute;cursor:pointer;top:-33px;right:8px;padding:10px 5px;display:inline}#bullseye-widget2 a.close,#bullseye-widget2 a.close:hover,#bullseye-widget2 div.arrow,#bullseye-widget2 div.arrow:hover{transition:none;text-decoration:none}#bullseye-widget2 #slidebox a.close:hover{background-position:0 -13px}#bullseye-widget2 #slidebox div.arrow{width:0;height:0;border-style:solid;border-width:7px 5px 0;border-color:#000 transparent transparent}#bullseye-widget2 .arrowWrap{padding:10px 5px;position:absolute;right:25px;cursor:pointer;top:-25px}#bullseye-widget2 .arrowWrap:hover{text-decoration:none}#bullseye-widget2 .storeImg{display:none;position:absolute;top:60px;left:10px;max-width:30%}#bullseye-widget2 .mapLink{border-radius:10px;bottom:38px;color:#fff;display:none;font-size:12px;font-weight:600;margin-top:12px;padding:8px;position:absolute;right:10px;text-align:center;transition:all 0s ease 0s;white-space:nowrap;width:145px}#bullseye-widget2 .mapLink:hover{opacity:.7;color:#fff;transition:0s;text-decoration:none}#bullseye-widget2 .storeImg>img{width:100%;height:auto;max-width:100px}#bullseye-widget2 .theDistance{position:absolute;font-size:11px;line-height:1.25em;font-style:italic;left:123px;bottom:38px}#bullseye-widget2 .searchAgain{background-color:#888;bottom:0;display:block;height:27px;position:absolute;vertical-align:middle;width:100%}#bullseye-widget2 .sapowered{position:relative;top:2px;float:right;padding-right:10px}#bullseye-widget2 .satext{display:inline-block;font-size:12px;padding:5px 0 0 10px;position:relative}#bullseye-widget2 .satext a:hover{color:#fff;text-decoration:none}#bullseye-widget2 .searchAgain *{color:#fff}#bullseye-widget2 #slidebox a.close:hover,#bullseye-widget2 .arrowWrap:hover{opacity:.8}body #bullseye-widget2 #slidebox *, body #bullseye-widget2 #slidebox p {font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;letter-spacing: 0!important;}@media only screen and (max-device-width:480px){#bullseye-widget2 #slidebox{width:100%;right:0!important;left:0!important;}#bullseye-widget2 #slidebox .headerWrap > p {font-size: 13px!important;position: absolute!important;left: 44px!important;top: 2px!important;white-space: nowrap!important;}}</style>';

  jQuery.cookie=function(e,n,o){if(arguments.length>1&&(null===n||"object"!=typeof n)){if(o=jQuery.extend({},o),null===n&&(o.expires=-1),"number"==typeof o.expires){var t=o.expires,r=o.expires=new Date;r.setDate(r.getDate()+t)}return document.cookie=[encodeURIComponent(e),"=",o.raw?String(n):encodeURIComponent(String(n)),o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("")}o=n||{};var i,p=o.raw?function(e){return e}:decodeURIComponent;return(i=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?p(i[1]):null};

  

  var bullseyeLocator = (function ($) {

    //Variables to modify

    var absoluteUrl = ''; //If you want to reference images/pages from another site, add the URL here between the quotes. Otherwise, leave it blank.
    var bullseyeApiKey = '407c3deb-e38e-4d7e-895b-9ea6302f61f2'; //Retrieve this from the Bullseye Admin
    var bullseyeClientId = '267'; //Retrieve this from the Bullseye Admin
    var displayLocName = true; //Display the name of the location in the banner
    var displayPhone = true; //Display the phone number of the location in the banner
    window.linkToLocalLocator =  'http://www.bullseyelocations.com/pages/teacher-search'; //Add a link to your locator page. 
    var locationTerm = 'Teacher'; //Change if your locations are termed different than store such as dealer, restaurant, location, etc.
    var searchRadius = '50'; //Can be any number
    var mapIconSrc = 'https://app.bullseyelocations.com/Images/Admin/Global/'; // Enter the directory path to where 'map-icon.png' and 'ajax-loader.gif' are uploaded on your server. e.g.: 'http://example.com/images/'
    var locatorHeadingText = 'FIND A MUSIC TEACHER'; // Change the heading text that appears at the top of the widget.  
	var defaultLocationImg = 'https://app.bullseyelocations.com/Images/Admin/Global/location_thumb_placeholder.gif'; //default image for the location if one does not exist	

    //Do not modify
    var bullseyeWsUrl = 'http://leadmanagerws.electricvine.com';
    var headerDivId = 'bullseye-banner-header';
    var headerInnerDivId = 'bullseye-banner-header-inner';
    var headerLoaderId = 'bullseye-banner-header-loader';
    var headerNoStoreId = 'bullseye-banner-header-no-store';
    var headerNearestStoreId = 'bullseye-banner-header-nearest-store';
    var beSrchCookieKey = "beloc_srchdata";


    function bullseyeWidget() {
      window.storeImg = $('.storeImg').detach();
      window.mapDir = $('.mapLink').detach();
      $('#bullseye-banner-header-nearest-store > address').before(storeImg);
      $(storeImg).css('display','inline-block');
      $('#bullseye-banner-header-nearest-store > address').after(mapDir);
      $(mapDir).css('display','inline-block');

      window.addressCopy = $('address').clone();
      $('.Addr').append(addressCopy);
      $(addressCopy).addClass('newAddress');
      $('.newAddress > span').empty();
      $('.newAddress br').replaceWith(' ');
      window.newAddress = $('.newAddress').text();
      $(mapDir).prop('href','http://maps.google.com/maps?saddr=&daddr=' + newAddress);
    }    

    function buildUrl(lat, lon) {
        var lat, lon;
        var url = bullseyeWsUrl + '/RestSearch.svc/DoSearch2?ClientId=' + bullseyeClientId + '&ApiKey=' + bullseyeApiKey + '&Latitude=' + lat + '&Longitude=' + lon + '&radius=' + searchRadius + '&StartIndex=0&PageSize=1';
        return url;
    }

    function buildLocationHtml(id, locName, address, city, state, zip, phone) {
        var headerNearestStore = $('<div/>', { id: headerNearestStoreId }).appendTo($('#' + headerInnerDivId));
        var headerMapLinkHref = linkToLocalLocator;

        $('<img/>', {
            src: mapIconSrc + 'map-icon.png',
            alt: 'Nearest ' + locationTerm
        }).appendTo(headerNearestStore);

        $(headerNearestStore).append('<p>' + locatorHeadingText + '</p>');     

        var addressTag = $('<address/>');
        var addressHtml = address + "<br/>" + city + " " + state + " " + zip;

        if(locName != "" && displayLocName == true) {
            addressHtml = "<span class='bullseye-banner-header-locname'>" + locName + "</span>" + addressHtml;
        } 

        if(phone != "" && displayPhone == true) {
            addressHtml = addressHtml + "<span class='bullseye-banner-header-phone'>" + phone + "</span>";
        }
        $(addressTag).append(addressHtml).appendTo(headerNearestStore);
        $($('#' + headerLoaderId)).hide();
        $($('#' + headerNoStoreId)).hide();
        $($('#' + headerNearestStoreId)).show();        

        //$('#' + headerInnerDivId).click(function() {
        //    location.href = linkToLocalLocator;
        //});
    }

    function showDefaultMessage() {
        var noStoreDiv = $('<div/>', { id: headerNoStoreId }).appendTo($('div#' + headerInnerDivId));
        $(noStoreDiv).append('<p>We could not locate a ' + locationTerm + ' near you.</p>');
        $('<a/>', {
            href: linkToLocalLocator,
            text: 'Visit locator'
        }).appendTo(noStoreDiv);

        $($('#' + headerLoaderId)).hide();
        $($('#' + headerNearestStoreId)).hide();
        $($('#' + headerNoStoreId)).show();
    }

    function getCookie (key) {
        var name = key + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1);
            if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
        }
        return "";
    }

    function setCookie (key, value, expMins) {
        var d = new Date();
        d.setTime(d.getTime() + (expMins*60*1000));
        var expires = "expires="+d.toUTCString();
        document.cookie = key + "=" + value + "; " + expires;
    }  

    return {
        getLocation: function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                                function (position) {
                                    lat = position.coords.latitude;
                                    lon = position.coords.longitude;

                                    var wsurl = buildUrl(lat, lon);

                                    $.getJSON(wsurl + "&callback=ResultList", function (data) { })
                                        .fail(function () {
                                            showDefaultMessage();
                                        })

                                        .done(function (data) {
                                            if (data.ResultList.length > 0) {
                                                var locationId = data.ResultList[0].Id != null ? data.ResultList[0].Id : "";
                                                var locName = data.ResultList[0].Name != null ? data.ResultList[0].Name : ""; 
                                                var address = data.ResultList[0].Address1 != null ? data.ResultList[0].Address1 : "";
                                                var city = data.ResultList[0].City != null ? data.ResultList[0].City : "";
                                                var state = data.ResultList[0].State != null ? data.ResultList[0].State : "";
                                                var zip = data.ResultList[0].PostCode != null ? data.ResultList[0].PostCode : "";
                                                var phone =  data.ResultList[0].PhoneNumber != null ? data.ResultList[0].PhoneNumber : "";
                                                window.imgLink = data.ResultList[0].ImageFileUrl != null ? data.ResultList[0].ImageFileUrl : defaultLocationImg;
                                                var distance = data.ResultList[0].Distance != null ? data.ResultList[0].Distance : "";
                                                var dataValStr = locationId  + '|' + locName + '|' + address + '|' + city + '|' + state + '|' + zip + '|' + phone + '|' + distance;

                                                buildLocationHtml(locationId, locName, address, city, state, zip, phone);
                                                setCookie(beSrchCookieKey, dataValStr, 60);                       

                                                bullseyeWidget();

                                                if (imgLink.indexOf('http') !== -1) {

                                                  $('.storeImg > img').attr('src', imgLink);

                                                } else {

                                                  $('.storeImg > img').attr('src', 'http://bullseyelocations.com' + imgLink);

                                                }

                                                jQuery.cookie('imgLink',imgLink, { expires: 7, path: '/' });

                                                jQuery.cookie('distance',distance, { expires: 7, path: '/' });

                                                window.location.reload();

                                            }

                                            else {

                                                showDefaultMessage();

                                            }

                                        });

                                },

                                function (error) {

                                    alert("Please enable your location or search using the locator.");

                                    showDefaultMessage();

                                }

                            );

            } else {

                alert("Please enable your location or search using the locator.");

                showDefaultMessage();

            }

        },

        buildBaseHtml: function () {

            var headerInnerDiv = $('<div/>', { id: headerInnerDivId }).appendTo($('#' + headerDivId));

            $('<img/>', {

                id: headerLoaderId,

                src: mapIconSrc + 'ajax-loader.gif',

                alt: 'loading...'

            }).appendTo(headerInnerDiv);

        },

        hasSearchCookie: function () {

            var hasCookie;

            var beSrchCookie = getCookie(beSrchCookieKey);



            if (beSrchCookie!="") {

                hasCookie = true;

                var beSrchCookieArr = beSrchCookie.split('|');

                buildLocationHtml(beSrchCookieArr[0], beSrchCookieArr[1], beSrchCookieArr[2], beSrchCookieArr[3], beSrchCookieArr[4], beSrchCookieArr[5], beSrchCookieArr[6]);

            }

            else

                hasCookie = false;



            return hasCookie;

        }

    }

} (jQuery));



$(function () {

    bullseyeLocator.buildBaseHtml();



    if(bullseyeLocator.hasSearchCookie() == false) {

        bullseyeLocator.getLocation();

    }

});



    

function bullseyeWidgetAfter() {

  window.storeImg = $('.storeImg').clone();

  window.mapDir = $('.mapLink').clone();

  $('#bullseye-banner-header-nearest-store > address').before(storeImg);

  $(storeImg).css('display','inline-block');

  $('#bullseye-banner-header-nearest-store > address').after(mapDir);

  $(mapDir).css('display','inline-block');



  window.addressCopy = $('address').clone();

  $('.Addr').append(addressCopy);

  $(addressCopy).addClass('newAddress');

  $('.newAddress > span').empty();

  $('.newAddress br').replaceWith(' ');

  window.newAddress = $('.newAddress').text();

  $(mapDir).prop('href','http://maps.google.com/maps?saddr=&daddr=' + newAddress);

  var imgCook = jQuery.cookie('imgLink');

  if (imgCook.indexOf('http') !== -1) {

    $('.storeImg > img').attr('src', imgCook);

  } else {

    $('.storeImg > img').attr('src', 'http://bullseyelocations.com' + imgCook);

  }

}  

  

$(function () {

  setTimeout(function() {

      if ($('#bullseye-banner-header-nearest-store > .mapLink').length) { 

      } else {

        bullseyeWidgetAfter();

      }

      if ($('.storeImg > img').attr('src') === 'http://bullseyelocations.com') {

        $('.storeImg > img').css('visibility','hidden');

      }

  }, 250);



  $("#bullseye-banner-header-nearest-store > img").each(function(index) {
    $(this).next("#bullseye-banner-header-nearest-store > p").andSelf().wrapAll("<div class='headerWrap' />")
  });
  $('#bullseye-banner-header-nearest-store > address').after('<div class="theDistance">Distance: ' + jQuery.cookie('distance') + ' mi</div>');

  $('#bullseye-banner-header').after('<div class="searchAgain"><span class="satext"><a href="' + linkToLocalLocator + '">SEARCH AGAIN</a></span><span class="sapowered"><img src="https://www.bullseyelocations.com/pages/Images/logo.png" alt="powered by Bullseye Location"></span></div>');    

  var slidebox = $('#slidebox');

  if (slidebox.length > 0) {

    $('#slidebox .close').on('click', function() {
      $(this).parent().remove();
      jQuery.cookie('hideBLwidget', 1, { expires: 1, path: '/' }); // Keep the widget hidden for 2 days when a customer hits the 'X' to close
    });

    $('#slidebox').on('click', function() {
      $('#slidebox').toggleClass('minWidg', 500);
    });
  }

  if (jQuery.cookie('hideBLwidget') == 1) {
    $('#slidebox').remove(); 
  }
});